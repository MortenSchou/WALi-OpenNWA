#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define URI_DELIMITER ' '
#define VERSION_DELIMITER '\n'

void LogRequest(char *buf) {
  printf("%s", buf);
}

void fatal(char *buf) {
  fprintf(stderr, buf);
  exit(1);
}

void process_request(char * input)
{
  char URI[80], version[80], msgbuf[100];
  int ptr=0, uri_len=0, ver_len=0, i, j;

  if (strncmp(input, "GET ", 4) != 0)
    fatal("Unsupported request");
  ptr = 4;
  while (input[ptr] != URI_DELIMITER) {
    if (uri_len < 80)
      URI[uri_len] = input[ptr];
    uri_len++; ptr++;
  }
  ptr ++;
  while (input[ptr] != VERSION_DELIMITER) {
    if (ver_len < 80)
      version[ver_len] = input[ptr];
    ver_len++; ptr++;
  }
  if (ver_len < 8 || version[5] != '1')
    fatal("Unsupported protocol version");

  for (i=0,ptr=0; i < uri_len; i++, ptr++)
    msgbuf[ptr] = URI[i];
  msgbuf[ptr++] = ',';
  for (j = 0; j < ver_len; j++, ptr++)
    msgbuf[ptr] = version[j];
  msgbuf[ptr++] = '\0';
  LogRequest(msgbuf);
}

int main(int argc, char *argv[])
{
  process_request(argv[1]);
  return 0;
}

